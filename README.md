# Proyecto de GestiÃ³n de Solicitud de Alumnos

Este proyecto es una aplicaciÃ³n web para gestionar las solicitudes de alumnado de FPDual por parte de las empresas.

## Funcionalidades Implementadas

### GestiÃ³n de Profesores

- **Crear nuevo profesor**: Permite registrar un nuevo profesor en el sistema.
- **Editar profesor**: Permite modificar la informaciÃ³n de un profesor existente.
- **Ver detalles del profesor**: Permite visualizar la informaciÃ³n detallada de un profesor.
- **Eliminar profesor**: Permite eliminar un profesor del sistema.

### GestiÃ³n de Empresas

- **Crear nueva empresa**: Permite registrar una nueva empresa en el sistema.
- **Editar empresa**: Permite modificar la informaciÃ³n de una empresa existente.
- **Ver detalles de la empresa**: Permite visualizar la informaciÃ³n detallada de una empresa.
- **Eliminar empresa**: Permite eliminar una empresa del sistema.

### GestiÃ³n de Solicitudes

- **Crear nueva solicitud**: Permite registrar una nueva solicitud en el sistema.
- **Editar solicitud**: Permite modificar la informaciÃ³n de una solicitud existente.
- **Ver detalles de la solicitud**: Permite visualizar la informaciÃ³n detallada de una solicitud.
- **Eliminar solicitud**: Permite eliminar una solicitud del sistema.

### RelaciÃ³n entre Empresas y Solicitudes

- **RelaciÃ³n 1:N**: Cada empresa puede tener mÃºltiples solicitudes asociadas.

### Seeder, Factory y Faker

- **Seeder**: Se han creado seeders para poblar la base de datos con datos iniciales.
- **Factory**: Se han creado factories para generar datos de prueba.
- **Faker**: Se utiliza Faker para generar datos aleatorios y realistas para pruebas y desarrollo.

# ðŸ“š ConfiguraciÃ³n de la API para la GestiÃ³n de Applications

## 1. **Modelo `Application`**

- El modelo `Application` tiene una relaciÃ³n **pertenece a** `Company`, definida en `Application.php` mediante el mÃ©todo `company()`.
- Los campos relevantes como `nif`, `company_activity`, `smr_1`, etc., estÃ¡n definidos en la propiedad `$fillable`.

## 2. **Request Personalizado (`ApplicationRequest.php`)**

- ValidaciÃ³n de los datos de entrada mediante `ApplicationRequest`.
- Los campos requeridos incluyen `nif`, `company_activity`, `modality`, y `company_id`, este Ãºltimo verificando que el `company_id` exista en la base de datos.
- Mensajes de error personalizados para cada campo obligatorio.

## 3. **Controlador `ApplicationController.php`**

El controlador maneja los mÃ©todos para las operaciones CRUD (Crear, Leer, Actualizar, Eliminar) de las `Applications`.

### **MÃ©todo `index()`**

- El mÃ©todo `index()` se usa para obtener todas las aplicaciones.
- Se retorna un conjunto de todas las aplicaciones registradas.

### **MÃ©todo `store()`**

- El mÃ©todo `store()` se usa para crear una nueva `Application`.
- Los datos de la solicitud son validados utilizando el `ApplicationRequest`, y luego se guardan en la base de datos.
- Se retorna un recurso `ApplicationResource` con los datos de la nueva aplicaciÃ³n.

### **MÃ©todo `show()`**

- El mÃ©todo `show()` se usa para obtener los detalles de una aplicaciÃ³n especÃ­fica mediante su ID.
- Se retorna un recurso `ApplicationResource` con los detalles de la aplicaciÃ³n solicitada.

### **MÃ©todo `update()`**

- El mÃ©todo `update()` se usa para actualizar los datos de una aplicaciÃ³n existente.
- Los datos de la solicitud son validados mediante `ApplicationRequest`, y luego se actualizan en la base de datos.
- Se retorna el recurso `ApplicationResource` con los datos actualizados.

### **MÃ©todo `destroy()`**

- El mÃ©todo `destroy()` se usa para eliminar una aplicaciÃ³n especÃ­fica mediante su ID.
- Se retorna un mensaje confirmando la eliminaciÃ³n.

## 4. **Rutas (`api.php`)**

Las rutas correspondientes a los mÃ©todos anteriores estÃ¡n registradas en el archivo `api.php`:

- **GET `/api/applications`**: `index()` â€” Obtiene todas las aplicaciones.
- **POST `/api/applications`**: `store()` â€” Crea una nueva aplicaciÃ³n.
- **GET `/api/applications/{applicationId}`**: `show()` â€” Obtiene los detalles de una aplicaciÃ³n especÃ­fica.
- **PUT `/api/applications/{applicationId}`**: `update()` â€” Actualiza los detalles de una aplicaciÃ³n especÃ­fica.
- **DELETE `/api/applications/{applicationId}`**: `destroy()` â€” Elimina una aplicaciÃ³n especÃ­fica.

Aunque usando Resource no hace falta que creemos todas las rutas ya que Laravel lo hace por nosotros, podemos listarlas con php artisan route:list

## 5. **Pruebas con Thunder Client**

### **GET: Obtener todas las Aplicaciones**

- **Thunder Client:** Se debe enviar una solicitud **GET** a `http://localhost/api/applications` para obtener todas las aplicaciones registradas en el sistema.

**Ejemplo de respuesta**:

```json
[
  {
    "id": 1,
    "nif": "96216229C",
    "company_activity": "Bases de datos",
    "smr_1": 1,
    "smr_2": 1,
    "dam_1": 1,
    "dam_2": 1,
    "daw_1": 1,
    "daw_2": 1,
    "observations": "otras",
    "modality": "Presencial",
    "company_id": 1
  },
  {
    "id": 2,
    "nif": "12345678A",
    "company_activity": "Software",
    "smr_1": 2,
    "smr_2": 2,
    "dam_1": 1,
    "dam_2": 2,
    "daw_1": 2,
    "daw_2": 1,
    "observations": "Comentarios",
    "modality": "Remoto",
    "company_id": 2
  }
]
```

---

### **POST: Crear una AplicaciÃ³n**

- **Thunder Client:** Se debe enviar una solicitud **POST** con **Content-Type: application/json** y un JSON con los campos correctos.

**Ejemplo de cuerpo de la solicitud**:

```json
{
    "nif": "96216229C",
    "company_activity": "Bases de datos",
    "smr_1": 1,
    "smr_2": 1,
    "dam_1": 1,
    "dam_2": 1,
    "daw_1": 1,
    "daw_2": 1,
    "observations": "otras",
    "modality": "Presencial",
    "company_id": 1
}
```

**Ejemplo de respuesta** (si la creaciÃ³n es exitosa):

```json
{
  "data": {
    "id": 1,
    "nif": "96216229C",
    "company_activity": "Bases de datos",
    "smr_1": 1,
    "smr_2": 1,
    "dam_1": 1,
    "dam_2": 1,
    "daw_1": 1,
    "daw_2": 1,
    "observations": "otras",
    "modality": "Presencial",
    "company_id": 1
  }
}
```

---

### **GET por ID: Ver una Solicitud EspecÃ­fica**

- **Thunder Client:** Se debe enviar una solicitud **GET** a `http://localhost/api/applications/{applicationId}` donde `{applicationId}` es el ID de la aplicaciÃ³n que quieres obtener.

**Ejemplo de respuesta**:

```json
{
  "id": 1,
  "nif": "96216229C",
  "company_activity": "Bases de datos",
  "smr_1": 1,
  "smr_2": 1,
  "dam_1": 1,
  "dam_2": 1,
  "daw_1": 1,
  "daw_2": 1,
  "observations": "otras",
  "modality": "Presencial",
  "company_id": 1
}
```

---

### **PUT: Actualizar una AplicaciÃ³n**

- **Thunder Client:** Se debe enviar una solicitud **PUT** con **Content-Type: application/json** y un JSON con los campos actualizados.

**Ejemplo de cuerpo de la solicitud**:

```json
{
    "nif": "12345678B",
    "company_activity": "Marketing",
    "smr_1": 3,
    "smr_2": 2,
    "dam_1": 2,
    "dam_2": 2,
    "daw_1": 2,
    "daw_2": 1,
    "observations": "ActualizaciÃ³n",
    "modality": "HÃ­brido",
    "company_id": 1
}
```

**Ejemplo de respuesta**:

```json
{
  "data": {
    "id": 1,
    "nif": "12345678B",
    "company_activity": "Marketing",
    "smr_1": 3,
    "smr_2": 2,
    "dam_1": 2,
    "dam_2": 2,
    "daw_1": 2,
    "daw_2": 1,
    "observations": "ActualizaciÃ³n",
    "modality": "HÃ­brido",
    "company_id": 1
  }
}
```

---

### **DELETE: Eliminar una AplicaciÃ³n**

- **Thunder Client:** Se debe enviar una solicitud **DELETE** a `http://localhost/api/applications/{applicationId}` donde `{applicationId}` es el ID de la aplicaciÃ³n que quieres eliminar.

**Ejemplo de URL**:

```
http://localhost/api/applications/1
```

**Ejemplo de respuesta**:

```json
{
  "message": "Application deleted successfully"
}

```

---

## 6. AutenticaciÃ³n

Este proyecto utiliza Laravel Sanctum para manejar la autenticaciÃ³n de las API. A continuaciÃ³n se describen los detalles sobre la autenticaciÃ³n y las rutas protegidas.

### Rutas PÃºblicas

Las siguientes rutas estÃ¡n disponibles sin autenticaciÃ³n:

-`POST /register`: Registra un nuevo usuario.

-`POST /login`: Autentica un usuario y devuelve un token de acceso.

### Rutas Protegidas

Las siguientes rutas estÃ¡n protegidas y requieren autenticaciÃ³n mediante un token de acceso:

-`GET /application`: Lista todas las aplicaciones.

-`POST /application`: Crea una nueva aplicaciÃ³n.

-`GET /application/{id}`: Muestra una aplicaciÃ³n especÃ­fica.

-`PUT /application/{id}`: Actualiza una aplicaciÃ³n especÃ­fica.

-`DELETE /application/{id}`: Elimina una aplicaciÃ³n especÃ­fica.

-`GET /professor`: Lista todos los profesores.

-`POST /professor`: Crea un nuevo profesor.

-`GET /professor/{id}`: Muestra un profesor especÃ­fico.

-`PUT /professor/{id}`: Actualiza un profesor especÃ­fico.

-`DELETE /professor/{id}`: Elimina un profesor especÃ­fico.

-`GET /company`: Lista todas las compaÃ±Ã­as.

-`POST /company`: Crea una nueva compaÃ±Ã­a.

-`GET /company/{id}`: Muestra una compaÃ±Ã­a especÃ­fica.

-`PUT /company/{id}`: Actualiza una compaÃ±Ã­a especÃ­fica.

-`DELETE /company/{id}`: Elimina una compaÃ±Ã­a especÃ­fica.

### Uso de Tokens

Para acceder a las rutas protegidas, los usuarios deben autenticarse y obtener un token de acceso. Este token debe ser incluido en el encabezado de las solicitudes a las rutas protegidas.

Ejemplo de encabezado de autorizaciÃ³n:

![1740563364336](image/README/1740563364336.png)

### Middleware de AutenticaciÃ³n

Las rutas protegidas estÃ¡n envueltas en un middleware de autenticaciÃ³n que verifica la validez del token de acceso. Si el token es vÃ¡lido, el usuario puede acceder a la ruta; de lo contrario, se devuelve un error de autenticaciÃ³n.

```php


Route::middleware('auth:sanctum')->group(function () {
    Route::resource('application', ApplicationApiController::class);
    Route::resource('professor', ProfessorApiController::class);
    Route::resource('company', CompanyApiController::class);
});
```


---

## 7. Tests

### Â¿Para quÃ© sirven los tests?

Los tests son una parte fundamental del desarrollo de software, ya que permiten verificar que el cÃ³digo funciona correctamente y cumple con los requisitos especificados. Ayudan a detectar errores y problemas antes de que el software sea desplegado en producciÃ³n, asegurando asÃ­ la calidad y la estabilidad del proyecto.

### Tipos de tests

En este proyecto, hemos implementado los siguientes tipos de tests:

-**Unit Tests**: Verifican el funcionamiento de unidades individuales de cÃ³digo, como funciones o mÃ©todos.

-**Feature Tests**: Verifican el comportamiento de caracterÃ­sticas completas del sistema, incluyendo la interacciÃ³n entre mÃºltiples unidades de cÃ³digo.

### Â¿CÃ³mo se crean los tests?

Para crear un test en Laravel, puedes usar el comando `make:test` de Artisan. Por ejemplo, para crear un test de unidad, puedes ejecutar

```
php artisan make:test ExampleTest --unit
```

Para crear un test de caracterÃ­sticas, puedes ejecutar:

```
php artisan make:test ExampleFeatureTest
```

Los tests se crean en el directorio `test` de tu proyecto. Los tests de unidad se colocan en `tests/Unit` y los tests de caracterÃ­sticas en [`Feature`](vscode-file://vscode-app/c:/Users/sergi/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-sandbox/workbench/workbench.html).

### Â¿CÃ³mo se ejecutan los tests?

Para ejecutar los tests, puedes usar el comando `test` de Artisan:

```
php artisan test
```

Este comando ejecutarÃ¡ todos los tests en el proyecto y mostrarÃ¡ un resumen de los resultados, incluyendo cuÃ¡ntos tests pasaron, fallaron o fueron omitidos.

### Tests implementados

En este proyecto, hemos implementado los siguientes tests:

#### Unit Tests

* **ProfesorTest** : Verifica la funcionalidad del modelo `Profesor`.
* **ApplicationTest** : Verifica la funcionalidad del modelo `Application`.

#### Feature Tests

* **AuthTest** : Verifica el proceso de registro y autenticaciÃ³n de usuarios.
* **ApplicationFeatureTest** : Verifica las operaciones CRUD (Crear, Leer, Actualizar, Eliminar) para las aplicaciones.
* **ProfessorFeatureTest** : Verifica las operaciones CRUD para los profesores.
* **CompanyFeatureTest** : Verifica las operaciones CRUD para las compaÃ±Ã­as.

### Ejemplo de un test

A continuaciÃ³n se muestra un ejemplo de un test de caracterÃ­sticas para la creaciÃ³n de un profesor:

```
<?php
// filepath: /tests/Feature/ProfessorFeatureTest.php
<?php

namespace Tests\Feature;

use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;
use App\Models\Profesor;

class ProfessorFeatureTest extends TestCase
{
    use RefreshDatabase;

    /** @test */
    public function it_can_create_a_professor()
    {
        $data = [
            'dni' => '12345678X',
            'name' => 'John',
            'surname' => 'Doe',
            'email' => 'john.doe@example.com',
            'phone' => '123456789',
            'department' => 'Computer Science',
        ];

        $response = $this->post('/api/professor', $data);

        $response->assertStatus(201);
        $this->assertDatabaseHas('professors', $data);
    }
}
```

Este test verifica que se puede crear un profesor correctamente y que los datos se almacenan en la base de datos.
